#!/bin/sh

set -e

export AWS_DEFAULT_REGION="{{ aws_bootstrap_aws_region }}"

if [ "$#" -ne 1 ]
then
  echo "Usage: `basename "$0"` module_folder"
  exit 1
fi

cd $1

terraform get -update
terraform apply -var-file=./terraform.tfvars -var-file=../terraform.tfvars

./terraform-remote-configure

#terraform remote config -backend=s3 -backend-config="bucket={{ aws_bootstrap_state_bucket }}" -backend-config="key=$1.tfstate"

